---
title: 'Chapter 4: Data Visualization'
description:
  'Making plots from the raw data is a powerful and somewhat underestimated tool that could give you a better understanding of what is going on in your data and some interesting insights. In this chapter we will look at the main plot types and how to create them in Python using Matplotlib and Seaborn packages.'
prev: /chapter3
next: /chapter5
type: chapter
id: 4
---

<exercise id="1" title="What can plots tell us, part 1" type="slides">

<slides source="chapter4_01_dataviz_1">
</slides>

</exercise>

<exercise id="2" title="What can plots tell us, part 2" type="slides">

<slides source="chapter4_01_dataviz_2">
</slides>

</exercise>

<exercise id="3" title="References">

1. Bertolero, M. A., Dworkin, J. D., David, S. U., Lloreda, C. L., Srivastava, P., Stiso, J., Zhou, D., Dzirasa, K., Fair, D. A., Kaczkurkin, A. N., Marlin, B. J., Shohamy, D., Uddin, L. Q., Zurn, P., & Bassett, D. S. (2020). Racial and ethnic imbalance in neuroscience reference lists and intersections with gender. *BioRxiv*. https://doi.org/10.1101/2020.10.12.336230
2. Callard, F., Smallwood, J., Golchert, J., & Margulies, D. S. (2013). The era of the wandering mind? Twenty-first century research on self-generated mental activity. *Frontiers in Psychology, 4*. https://doi.org/10.3389/fpsyg.2013.00891
3. Casey, B., Cannonier, T., Conley, M. I., Cohen, A. O., Barch, D. M., Heitzeg, M. M., Soules, M. E., Teslovich, T., Dellarco, D. V., Garavan, H., Orr, C. A., Wager, T. D., Banich, M. T., Speer, N. K., Sutherland, M. T., Riedel, M. C., Dick, A. S., Bjork, J. M., Thomas, K. M., . . . Dale, A. M. (2018). The Adolescent Brain Cognitive Development (ABCD) study: Imaging acquisition across 21 sites. *Developmental Cognitive Neuroscience, 32*, 43–54. https://doi.org/10.1016/j.dcn.2018.03.001
4. Charpentier, C., de Neve, J., Roiser, J. P., & Sharot, T. (2016). Models of Affective Decision-Making: How Do Feelings Predict Choice? *SSRN Electronic Journal*. https://doi.org/10.2139/ssrn.2734088
5. Chataway, J., de Angelis, F., Connick, P., Parker, R. A., Plantone, D., Doshi, A., John, N., Stutters, J., MacManus, D., Prados Carrasco, F., Barkhof, F., Ourselin, S., Braisher, M., Ross, M., Cranswick, G., Pavitt, S. H., Giovannoni, G., Gandini Wheeler-Kingshott, C. A., Hawkins, C., . . . Bastow, R. (2020). Efficacy of three neuroprotective drugs in secondary progressive multiple sclerosis (MS-SMART): a phase 2b, multiarm, double-blind, randomised placebo-controlled trial. *The Lancet Neurology, 19*(3), 214–225. https://doi.org/10.1016/s1474-4422(19)30485-5
6. Farinelli, M., Panksepp, J., Gestieri, L., Leo, M. R., Agati, R., Maffei, M., Leonardi, M., & Northoff, G. (2013). SEEKING and depression in stroke patients: An exploratory study. *Journal of Clinical and Experimental Neuropsychology, 35*(4), 348–358. https://doi.org/10.1080/13803395.2013.776009
7. Gosselke Berthelsen, S., Horne, M., Shtyrov, Y., & Roll, M. (2020). Different neural mechanisms for rapid acquisition of words with grammatical tone in learners from tonal and non-tonal backgrounds: ERP evidence. *Brain Research, 1729*, 146614. https://doi.org/10.1016/j.brainres.2019.146614
8. Hauser, T. U., Hunt, L. T., Iannaccone, R., Walitza, S., Brandeis, D., Brem, S., & Dolan, R. J. (2015). Temporally Dissociable Contributions of Human Medial Prefrontal Subregions to Reward-Guided Learning. *Journal of Neuroscience, 35*(32), 11209–11220. https://doi.org/10.1523/jneurosci.0560-15.2015
9. Leung, C., Lei, K. S., Wang, S. M., & Lam, B. Y. H. (2021). Theory of mind in schizotypy: A behavioral and event-related potential (ERP) study. *Schizophrenia Research: Cognition, 23*, 100190. https://doi.org/10.1016/j.scog.2020.100190
10. Meghdadi, A. H., Berka, C., Richard, C., Rupp, G., Smith, S., Stevanović Karić, M., McShea, K., Sones, E., Marinković, K., & Marcotte, T. (2021). EEG event related potentials in sustained, focused and divided attention tasks: Potential biomarkers for cognitive impairment in HIV patients. *Clinical Neurophysiology, 132*(2), 598–611. https://doi.org/10.1016/j.clinph.2020.11.026
11. Nivard, M. G., Gage, S. H., Hottenga, J. J., van Beijsterveldt, C. E., Abdellaoui, A., Baselmans, B. M., Ligthart, L., St Pourcain, B., Boomsma, D. I., Munafoò, M. M., & Middeldorp, C. M. (2016). Genetic overlap between schizophrenia and developmental psychopathology: a longitudinal approach applied to common childhood disorders between age 7 and 15 years. *BioRxiv*. https://doi.org/10.1101/052829
12. O’Connell, G., de Wilde, J., Haley, J., Shuler, K., Schafer, B., Sandercock, P., & Wardlaw, J. M. (2011). The brain, the science and the media. *EMBO Reports, 12*(7), 630–636. https://doi.org/10.1038/embor.2011.115
13. Schiro, M. M., Stauber, S. E., Peterson, T. L., Krueger, C., Darnell, S. J., Satyshur, K. A., Drinkwater, N. R., Newton, M. A., & Hoffmann, F. M. (2011). Mutations in Protein-Binding Hot-Spots on the Hub Protein Smad3 Differentially Affect Its Protein Interactions and Smad3-Regulated Gene Expression. *PLoS ONE, 6*(9), e25021. https://doi.org/10.1371/journal.pone.0025021
14. van Atteveldt, N. M., van Aalderen-Smeets, S. I., Jacobi, C., & Ruigrok, N. (2014). Media Reporting of Neuroscience Depends on Timing, Topic and Newspaper Type. *PLoS ONE, 9*(8), e104780. https://doi.org/10.1371/journal.pone.0104780

</exercise>

<exercise id="4" title="Check yourself" >

**Question 1**. What combination has approximately the greatest value?

<center><img src="data_viz/heat_map_test.png" width="500"></center>

<choice id="1">

<opt text="(Clone B9, Vimentin)">
Check the colorbar on the right.
</opt>

<opt text="(Clone B2, AMY)">
Is it largest or the lowest value?
</opt>

<opt text="(Clone B2, CK18)" correct="true">
It is hard to say if it's *the greatest*, but it's one of the largest values for sure.
</opt>

<opt text="It cannot be defined from this chart">
Why not? Check the colorbar on the right.
</opt>
</choice>

**Question 2**. What are the guidelines for creating clear and human readable chart?

<choice id="2">

<opt text="Describe chart with titles, labels and annotations" correct="true">
Help people easily understand what you tried to show on the plot.
</opt>

<opt text="Include as many different colors as you can">
This would be true, if you wanted to create an eye hell.
</opt>
</choice>

**Question 3**. [...] are often being criticized since it can be difficult to compare different sections of a given chart, or to compare data across different charts.

<choice id="3">
<opt text="Bar charts">
In fact bar plots are very good for comparison multiple groups at once.
</opt>

<opt text="Line plots">
The range of the y axis makes it easy to compare different groups/labels.
</opt>

<opt text="Pie charts" correct="true">
Check out this plot: https://en.wikipedia.org/wiki/Pie_chart#/media/File:Badpie.png
</opt>
</choice>

**Question 4**. What groups have possible outlier values?

<center><img src="data_viz/boxplot_test.jpg" width="500"></center>

<choice id="4">
<opt text="All of them">
Do all the boxplots have values outside the [Q1 - 1.5IQR; Q3 + 1.5IQR] range?
</opt>

<opt text="None of them">
Look closer.
</opt>

<opt text="Control & SZ" correct="true">
There are one possible outlier for the Insulin (Control) and Growth hormone (SZ) groups.
</opt>

<opt text="Control">
Is it the only group?
</opt>
</choice>

</exercise>

<exercise id="5" title="How to create a meaningful plot">

### Rule of thumb:

1. Think about what answer should you visualization answer.
2. Choose the right chart for your data.
3. Make it clear and human-readable.
4. Don’t put too much information on one chart.
5. Describe it with titles, labels, and annotations.
6. Don’t go crazy with colors.

**[Cheat-sheet](http://2.bp.blogspot.com/-6D6p5m-iEsE/W5mMGKBa_xI/AAAAAAAABI4/9zF4sNy7V6QOy__CDFe-kY_xnLVKyijxgCK4BGAYYCw/s1600/98510-728109.jpg)** that can help with choosing the appropriate plot type.


</exercise>

<exercise id="6" title="Packages for data visualization" type="slides">

<slides source="chapter4_03_dataviz_packages">
</slides>

</exercise>

<exercise id="7" title="Make your plots">

**Exercise 1. Breast cancer diagnostic data set**

Sample of the data set:

<center><img src="imgs/breast_cancer.png"></center>

1. Load the data with breast cancer observations (path to the file `"exercises/data/breast_cancer.csv"`);
2. Make a **scatter plot** of `radius_mean` on the `x` axis against `texture_mean` on the `y` axis along with the **regression line**. You can do this in one line of code using [`sns.regplot()`](https://seaborn.pydata.org/generated/seaborn.regplot.html) function. Specify standard deviation as an error term (`x_ci="sd"`);
3. Add a vertical line with average radius and horizontal line with average texture. Set both of them to be `"dashed"`, `"black"` colored, and of width `1`.

<codeblock id="04_01">

* you can use a `.mean()` method to get the average value from pandas Series;

</codeblock>

What is the approximate correlation between `texture_mean` and `radius_mean`?

<choice id="1">
<opt text="Around -0.4">
What happens to texture_mean when radius_mean increases?
</opt>

<opt text="Around 0.4" correct="true">
To be more precise, it's 0.32.
</opt>

<opt text="Around 0">
Is there really no relationship between variables?
</opt>
</choice>

**Exercise 2**. It's always a good idea to check for a relationship among variables in the data before applying Machine Learning algorithms. One of the possible ways to do this is to check the correlation. Looking at the raw numbers of correlation might be not that productive and that's when **heatmap** becomes handy.

1. Load the data with breast cancer observations (path to the file `"exercises/data/breast_cancer.csv"`);
2. Select only columns the average values (with the `"mean"` in the name);
3. Create a correlation matrix and store it to `corr_matrix` variable;
4. Pass the `corr_matrix` into the [`sns.heatmap()`](https://seaborn.pydata.org/generated/seaborn.heatmap.html) function to create a heatmap.

<codeblock id="04_02">

* one of the possible ways to get only columns with `"mean"` in the name is to use `filter()` and `lambda` functions on the list of column names (`df.columns`);
* correlation matrix can be found by `df.corr()` method.

</codeblock>

What combination of variables can lead to problems during the modeling part (has high correlation)?

<choice id="2">
<opt text="texture_mean & smoothness_mean">
Correlation between these two variables is around -0.1.
</opt>

<opt text="texture_mean & perimeter_mean">
Correlation between these two variables is around 0.3.
</opt>

<opt text="area_mean & perimeter_mean" correct="true">
This shouldn't be that surprising. The higher the perimeter, the higher the area.
</opt>
</choice>

</exercise>

<exercise id="8" title="Exploratory data analysis">

In statistics, **exploratory data analysis** is an approach to analyzing data sets to summarize their main characteristics, often using statistical graphics and other data visualization methods. A statistical model can be used or not, but primarily EDA is for seeing what the data can tell us beyond the formal modeling or hypothesis testing task. Exploratory data analysis was promoted by John Tukey to encourage statisticians to explore the data, and possibly formulate hypotheses that could lead to new data collection and experiments.

<center><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/ba/Data_visualization_process_v1.png/800px-Data_visualization_process_v1.png" width="600"></center>

Credits: [Wikipedia](https://en.wikipedia.org/wiki/Exploratory_data_analysis)

#### Exercise 1. Dementia data set

Sample of the data set:

<center><img src="imgs/oasis.png"></center>

* Load the data with dementia patients' observations (path to the file `"exercises/data/oasis_cross-sectional.csv"`).
* Create 4 grouped bar charts at the same figure (using `plt.subplot()`). Variables to plot:
    * `y` axis: age (`"Age"`), years of education (`"Educ"`), socioeconomic status (`"SES"`), Mini-Mental State Examination score (`"MMSE"`);
    * `x` axis: Clinical Dementia Rating (`"CDR"`)
    * group (`hue` argument) by gender (`"M/F"`)

CDR classification:

* 0 = Normal
* 0.5 = Very Mild Dementia
* 1 = Mild Dementia
* 2 = Moderate Dementia

Additionally, create a `summary_stats` DataFrame with the count of observations (`"ID"` column) and aggregated values (mean and standard deviation of these four variables).

<codeblock id="04_03">

* recall `plt.subplot(<total rows in a figure>, <total columns in a figure>, <current plot>)`;
* to create a DataFrame with summary statistics you can group by two variables (dementia rating and gender) and get the aggregated values for specific columns.

</codeblock>

What statement is correct:

<choice id="1">
<opt text="There are 2 people in the data set with moderate dementia and both are males">
There are 2 people with moderate dementia, 1 male and 1 female.
</opt>

<opt text="Age the dementia status (CDR) are positively correlated" correct="true">
On average people with more severe dementia are older.
</opt>

<opt text="Healthy controls (no dementia) have more variability for mini-mental state examination score compared to dementia patients.">
Look at the size of error bars.
</opt>
</choice>

Here is an example how you could automate the subplots creation using the `for` loop:

```python
columns_to_plot = ["Age", "Educ", "SES", "MMSE"]

plt.figure(figsize=(10,7), facecolor="white")

for (i, colname) in enumerate(columns_to_plot):
    plt.subplot(2,2,i+1)
    sns.barplot(
        x="CDR", data=dementia_df, y=colname,
        hue="M/F", ci="sd", color="lightblue")
    plt.title(f"{colname} (Mean ± SD)")

plt.tight_layout()
plt.show()
```

<br>

#### Exercise 2

Seaborn package is really powerful and it allows to create complex plots in a simple way. Let's look at the [`sns.relplot()`](https://seaborn.pydata.org/generated/seaborn.relplot.html) (relational plot) for example. By default, it creates a scatter plot between two variables with a possibility to add additional grouping variables.

1. Plot the relationship between estimated total intracranial volume (`"eTIV"`) and normalized whole-brain volume (`nWBV`);
2. Split plots to separate columns according to the clinical dementia rating (`"CDR"`) using `col` argument;
3. Set the color of each point according to the gender (`"M/F"`) using `hue` argument;
4. Set the size of a point according to the atlas scaling factor (`"ASF"`) using `size` column.

<codeblock id="04_04">

* everything you need is in the task;

</codeblock>

What statement is correct:

<choice id="2">
<opt text="On average females have greater total intracranial volume">
Look at the colors and x axis.
</opt>

<opt text="There is a strong positive relationship between eTIV and nWBV among different groups">
It looks like there is no relationship at all.
</opt>

<opt text="On average values of atlas scaling factor increase as the estimated total intracranial volume increases" correct="true">
Look at the size of the point and what's happening when we move along x axis.
</opt>
</choice>

</exercise>

<exercise id="9" title="Data viz hacking" type="slides">

<slides source="chapter4_02_dataviz_hacking">
</slides>

</exercise>

<exercise id="10" title="What went wrong here?">

**Question 1**. Is this plot done correctly?

<center><img src="data_viz/pie_chart_quiz.jpg" width="500"></center>

<choice id="1">
<opt text="Yes, there is nothing wrong with this plot">
Compare the numerical values and the actual circle proportion.
</opt>

<opt text="No, proportion and numerical values do not agree" correct="true">
42% look more like 33%.
</opt>

<opt text="No, total sum is not 100%">
Well, that's true, but that could be caused by a rounding error and it's not the biggest problem of the plot.
</opt>
</choice>

**Question 2**. What about this one?

<center><img src="data_viz/bad_bar_quiz.jpg" width="500"></center>

<choice id="2">
<opt text="Yes, there is nothing wrong with this plot">
Check the scale of the x axis.
</opt>

<opt text="No, this should have been a vertical bar plot" >
There is nothing wrong to use a horizontal bar chart in this case.
</opt>

<opt text="Scale is corrupted" correct="true">
Makati City and Quezon City have a huge numerical difference, but small "visual difference".
</opt>
</choice>

</exercise>
